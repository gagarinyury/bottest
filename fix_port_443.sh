#!/bin/bash

echo "üöÄ –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–∞ 443..."

# 1Ô∏è‚É£ –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–Ω–∏–º–∞–µ—Ç –ø–æ—Ä—Ç 443
PORT_PROCESS=$(sudo ss -tlnp | grep ":443" | awk '{print $7}' | cut -d',' -f2 | cut -d'=' -f2)

if [ -n "$PORT_PROCESS" ]; then
    echo "‚ùå –ü–æ—Ä—Ç 443 –∑–∞–Ω—è—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º —Å PID: $PORT_PROCESS"
    
    # 2Ô∏è‚É£ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ Nginx
    if ps -p $PORT_PROCESS -o comm= | grep -q "nginx"; then
        echo "‚úÖ Nginx –∑–∞–Ω–∏–º–∞–µ—Ç –ø–æ—Ä—Ç 443, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –µ–≥–æ..."
        sudo systemctl restart nginx
    else
        echo "üõë –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 443..."
        sudo kill -9 $PORT_PROCESS
    fi
else
    echo "‚úÖ –ü–æ—Ä—Ç 443 —Å–≤–æ–±–æ–¥–µ–Ω."
fi

# 3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª—Å—è –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ 443 –ø–æ—Ä—Ç—É
sudo ss -tlnp | grep ":443" || echo "‚úÖ –ü–æ—Ä—Ç 443 —Ç–µ–ø–µ—Ä—å —Å–≤–æ–±–æ–¥–µ–Ω."

echo "üöÄ –ü—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞..."
cd ~/professor_y_bot
python bot.py
